<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Revocation of Certificates</title>
    <meta name="robots" content="noindex, noarchive, nofollow">
    <link rel="stylesheet" href="http://www.cisco.com/etc/designs/cdc/clientlibs/responsive/css/cisco-sans.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="shortcut icon" href="lock-icon.ico">

    <!-- <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,300' rel='stylesheet' type='text/css'> -->

    <!-- Animate.css -->
    <link rel="stylesheet" href="../../css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="../../css/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="../../css/bootstrap.css">
    <!-- Superfish -->
    <link rel="stylesheet" href="../../css/superfish.css">

    <!--<link rel="stylesheet" href="../../css/style.css">-->


    <!-- Modernizr JS -->
    <script src="../../js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="js/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="../../css/style-mockup1.css" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  </head>

  <body background="..\..\images\test9.jpg">
    <div id="header">
      <header id="fh5co-header-section">
        <div class="container">
          <div class="nav-header">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <h1 id="fh5co-logo"><a href="..\..\index.html"><strong><font color="white">Crypto Done Right!</font></strong></a></h1>
            <!-- START #fh5co-menu-wrap -->
            <nav id="fh5co-menu-wrap" role="navigation">
              <ul class="sf-menu" id="fh5co-primary-menu">
                <!--<li class="active">
                  <a href="index.html"><font color="black">Home</font></a>
                </li>-->
                <li>
                  <a href="..\..\articles\cryptographic_protocols\cryptographic-protocols.html" class="fh5co-sub-ddown"><font color="white">Cryptographic Protocols</font></a>
                  <ul class="fh5co-sub-menu">
                    <li><a href="..\..\articles\cryptographic_protocols\basics.html" ><font color="black">Basics</font></a></li>
                    <li><a href="#" class="fh5co-sub-ddown">SSL</a>
                        <ul class="fh5co-sub-menu">
                          <li><a href="..\..\articles\cryptographic_protocols\ssl-2.html">SSL 2.0</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\ssl-3.html">SSL 3.0</a></li>
                        </ul>
                    </li>
                    <li><a href="#" class="fh5co-sub-ddown">TLS</a>
                        <ul class="fh5co-sub-menu">
                          <li><a href="..\..\articles\cryptographic_protocols\tls-1.html">TLS 1.0</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\tls-1-1.html" >TLS 1.1</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\tls-1-2.html" >TLS 1.2</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\tls-1-3.html" >TLS 1.3</a></li>
                        </ul>
                    </li>
                    <li><a href="#" class="fh5co-sub-ddown">SSH</a>
                        <ul class="fh5co-sub-menu">
                          <li><a href="..\..\articles\cryptographic_protocols\sshv1.html" >SSH 1.0</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\sshv2.html" >SSH 2.0</a></li>
                        </ul>
                    </li>
                  </ul>
                </li>

                <li>
                  <a href="..\..\articles\cryptographic_protocols\encryption.html" class="fh5co-sub-ddown"><font color="white">Encryption</font></a>
                  <ul class="fh5co-sub-menu">
                    <li><a href="..\..\articles\cryptographic_protocols\encryption.html" ><font color="black">Introduction</font></a></li>
                      <li><a href="#" class="fh5co-sub-ddown">AES</a>
                        <ul class="fh5co-sub-menu">
                          <li><a href="..\..\articles\cryptographic_protocols\aes.html" >Introduction</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\aes-ctr.html" >AES CTR</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\aes-cbc.html" >AES CBC</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\aes-gcm.html">AES GCM</a></li>
                        </ul>
                      </li>
                    <li><a href="#" class="fh5co-sub-ddown">DES</a></li>
                    <li><a href="..\..\articles\cryptographic_protocols\3des.html" class="fh5co-sub-ddown">3DES</a></li>
                  </ul>
                </li>

                <li>
                  <a href="#" class="fh5co-sub-ddown"><font color="white">Hashing Algorithms</font></a>
                   <ul class="fh5co-sub-menu">
                    <li><a href="..\..\articles\hashing_algorithms\example_index.html">Introduction</a></li>
                    <li>
                      <a href="#" class="fh5co-sub-ddown">Hash Functions</a>
                      <ul class="fh5co-sub-menu">
                          <li><a href="#" class="fh5co-sub-ddown">Unkeyed</a>
                        <ul class="fh5co-sub-menu">
                          <li><a href="..\..\articles\hashing_algorithms\md5.html" >MD5</a></li>
                          <li><a href="..\..\articles\hashing_algorithms\sha1.html" >SHA-1</a></li>
                          <li><a href="..\..\articles\hashing_algorithms\sha2.html" >SHA-2</a></li>
                          <li><a href="..\..\articles\hashing_algorithms\sha3.html" >SHA-3</a></li>
                        </ul>
                        </li>
                          <li><a href="#" class="fh5co-sub-ddown">Keyed</a>
                        <ul class="fh5co-sub-menu">
                          <li><a href="http://freehtml5.co/preview/?item=build-free-html5-bootstrap-template" tar
                                 ="_blank">More to come..</a></li>
                            </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><a href="..\..\about.html"><font color="white">About</font></a></li>
                <li><a href="..\..\contact.html"><font color="white">Contact</font></a></li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
    </div>

      <div id="contentScroller">
      <strong style="font-size:2vw;">Content</strong>
      <br />
      <ul>
        <a href="#introduction"><li>
          Introduction
            </li></a><br />
        <a href="#crl"><li>
          Certificate Revocation Lists
            </li></a><br />
        <a href="#ocsp"><li>
              OCSP
            </li></a><br />
        <a href="#ocspstapling"><li>
              OCSP Stapling
            </li></a><br />
        <a href="#browsers"><li>
              How do browsers deal with revoked certificates?
            </li></a><br />
      </ul>
    </div>

    <div class="breadcrumbs">
      <ol class="breadcrumb">
         <li class="breadcrumb-item level"><a href="../../index.html">Home</a></li>
         <li class="breadcrumb-item level"><a href="../articles.html">Articles</a></li>
         <li class="breadcrumb-item level"><a href="cryptographic-protocols.html">Cryptographic Protocols</a></li>
         <li class="breadcrumb-item level0"><a href="basics.html">Basics</a></li>
         <li class="breadcrumb-item level1 active">PKI</li>
       </ol>
    </div>

    <div class="container-fluid">
      <div class="row" style="padding: 2vw;">

        <div class="col-md-12 col-sm-12 col-xs-12">
          <p>
           <img src="../../images/pki.jpg" style="width:500px;height:275px;" class="center" />

            <center><h2>Certificates Revocation</h2></center>
            <br /> <br />

            <strong>INTRODUCTION</strong><br /><br/>

            Certificate Revocation is an important concept in the PKI world. Imagine a simple scenario where you as an IT administrator issued out certificates to all of your
            company's employees in order for them to be able to authenticate themselves while using the company's VPN. In a case where an employee leaves and somehow carries
            with him the certificate that was issued to him, what is preventing your VPN server from disregarding the certificate as it now is an unauthorized connection.
            This is where certificate revocation comes in. In a nutshell, certificate revocation involves a list that contains the certificates that have been revoked
            (indexed by for example, a serial number) that is checked before validating a certificate.<br /><br />

            What is also important to understand is that revocation is in general a difficult problem to solve. We will understand them better once we understand the basic concepts
            around how revocation and revocation checks are done in the PKI world.<br /><br />

            <b>Certificate Revocation Lists (CRL)</b><br /><br />
            The lists that were used to maintain the revoked certificates is called the Certificate Revocation List. Certificate Authorities would maintain these lists with the
            revoked certificates that clients (in the above example, the VPN server) could reach out to and check for a certificates revocation status. The CRL is created and digitally
            signed by the CA that originally issued the certificates. The CRL contains dates for when each certificate was issued and when it expires. Clients could be any end point
            that is trying to verify if a certificate that is being used for identity is revoked or not (web browsers is a common example). Here are a few examples of how CAs used to
            maintain CRLs:<br /><br />

            <img src="../../images/certificate-revocation-list.png"  alt="CRL Fetch and Check" style="width:700px;height:275px;" class="center" />
            <figcaption>Fig.1 - CRL Fetch and Check</figcaption><br /><br />
            <img src="../../images/cdp.png" style="width:400px;height:500px;" class="center" /><br /><br />
            <figcaption>Fig.1 - CRL Fetch and Check</figcaption><br /><br /></div>



            <b>When implementing CRLs, you should consider the following design considerations:</b><br />
            <ul>
                <li><u>CRLs have a lifetime:</u> CRLs are only valid for a certain period of time just as certificates. When the CRL expires, the client usually deletes it from its cache. A new CRL is
            downloaded when a certificate is presented for verification; however, if a newer version of the CRL that lists the certificate under examination is on the server but the
            client is still using the CRL in its cache, the router does not know that the certificate has been revoked. The certificate passes the revocation check even though it should
            have been denied.</li>
            <li><u>Lack of scalability:</u> This worked great in the past when there were few websites and certificates, but given today’s scale of the Internet, it’s practically infeasible for CA to manage and for
            client to download these huge lists, whenever they need to check for revocation status. If your infrastructure also contains extremely long lists, expect some latency.</li>
            <li><u>Various ways to download CRLs:</u> The method of the CDP determines how the CRL is retrieved; some possible choices include HTTP, Lightweight Directory Access Protocol (LDAP), SCEP, or TFTP.
            HTTP, TFTP, and LDAP are the most commonly used methods.</li>
          </ul><br /><br />

            <strong>Online Certificate Status Protocol (OCSP)</strong><br />
            As pointed out above, the major problem with CRL is its size and the challenges in downloading and storing the lists on the clients. A solution to this problem was OCSP where
            instead of bothering with keeping updated lists on the clients, the client could simply reach out to the OCSP server and get the "OCSP status" for a particular certificate
            it would like to check against. Here is an overview of how OCSP works:<br /><br />

            <img src="../../images/ocsp.png" style="width:600px;height:400px;" class="center" /><br /><br />


            <b>So there is an obvious advantage but there are weaknesses here too:</b>
            <ul>
              <li>They add up latency: Additional dependency and query between client and CA servers during TLS handshake, that adds up latency.</li>
              <li>Trusting the CA infrastructure: Poor, unreliable CA infrastructure. Prone to availability problems. The CA servers are targets for DoS attacks.</li>
              <li>Latency: Slow OCSP response adds up latency too.</li>
              <li>Privacy compromise: Browser leaks what website is being accessed and who accesses it to CA servers.</li>
            </ul><br /><br />

            <strong>When to Use an OCSP Server</strong><br />
            OCSP may be more appropriate than CRLs if your PKI has any of the following characteristics:<br />
            <ul>
              <li> Real-time certificate revocation status is necessary. CRLs are updated only periodically and the latest CRL may not always be cached by the client device.
                For example, if a client does not yet have the latest CRL cached and a newly revoked certificate is being checked, that revoked certificate will successfully
                 pass the revocation check.</li>
              <li>There are a large number of revoked certificates or multiple CRLs. Caching a large CRL consumes large portions of Cisco IOS memory and may reduce resources available to other processes.</li>
              <li>CRLs expire frequently, causing the CDP to handle a larger load of CRLs.</li>
            </ul><br /><br />

            <strong>How to implement CRLs or OCSPs:</strong><br /><br />
            Vendors have documentation on how revocation checks can be configured. CRLs are not widely used these days and OCSP is a popular solution (inspite of the weaknesses).<br /><br />

            A few examples:<br />
          <ul>
            <li><a href="https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/sec_conn_pki/configuration/xe-3s/sec-pki-xe-3s-book/sec-cfg-auth-rev-cert.html#GUID-FDD8F5A9-4FF3-4E0F-9674-AAC6D1B68C55">Cisco IOS XE</a></li>
            <li><a href="https://www.cisco.com/c/en/us/td/docs/security/asa/asa82/configuration/guide/config/cert_cfg.html">Cisco ASA</a></li>
            <li><a href="https://httpd.apache.org/docs/current/mod/mod_ssl.html">Apache Server</a></li>
            <li><a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_crl">Nginx Serve</a></li>
            <li><a href="https://www.arubanetworks.com/techdocs/ArubaOS_63_Web_Help/Content/ArubaFrameStyles/CertRevocation/About_OCSP_and_CRL.htm">ArubaOS Controller</a></li>
          </ul><br /><br />

            <strong>OCSP Stapling:</strong><br />
            A relatively new approach to revocation is to use OCSP Stapling. OCSP Stapling involves the webserver (that is hosting the website of whose certificate is being checked),
            regularly  polling the OCSP server (which is usually the CA) and serving the OCSP response to the end clients. The https server periodically polls OCSP server for revocation
            status of its own certificate(s), and sends OCSP response along with certificate (staples) to the client during TLS handshake in a ServerCertificateStatus message.
            OCSP responses are short-lived (around a week). They are signed by CA, so client can trust them. <br /><br />

            OCSP stapling approach solves several issues, inherent to regular OCSP approach:<br />
            <ul>
              <li>Removes dependency between client and CA servers. No additional query, faster TLS handshake.</li>
              <li>Protect website visitors privacy. Since browsers don’t talk to CA servers any more, they don’t leak browsing activity.</li>
              <li>More resistant to CA server availability issues, since web server caches OCSP responses which are valid for several days.</li>
              <li>Less load on CA servers, since number of https servers is less than number of clients/visitors.</li>
            </ul>

            <img src="../../images/OCSP-Stapling.png" style="width:700px;height:400px;" class="center" /><br /><br />

            <b><u>Weakness of OCSP Stapling</b>: OCSP stapling is an option and not mandatory. Clients don’t know whether to expect/require stapled OCSP responses from a website or not.
            If an attacker has a stolen revoked certificate it can be used without stapling. Browsers will fallback to regular OCSP, which can again be blocked,
            and browser will accept the certificate. We still have soft-fail behavior with a false sense of security.</u><br /><br />

            <strong>An important note about how browsers have some slightly better ways to deal with revocation:</strong><br /><br />
            Browsers are possibly the clients that would need to use the CRL feature the most due to
            Given dependency to poor and not-reliable CA infrastructure, browsers/clients usually tend to use soft-fail (ignore) behavior, when they don’t receive OCSP response in
            a timely manner or encounter some errors, assuming that certificate is valid and allowing to access the website. Some browsers just show warning, that user can bypass.
            Chrome, for example, does not use OCSP at all, and use its own proprietary mechanism, called CRLSet. The reason for such soft-fail behavior is because unavailable CA servers
            should not block access to all websites, using their certificates.<br /><br />

            Soft-fail behavior gives us false sense of security — it’s OK when you get revocation warning, but when you don’t — you’re in doubt if cert is valid indeed or if there
            is an OSCP infrastructure related issue. For example, attacker can block OCSP traffic and cause revocation checks to pass.
            [Source: https://medium.com/@alexeysamoshkin/how-ssl-certificate-revocation-is-broken-in-practice-af3b63b9cb3] <br /><br />

            Additional Read:<a href="https://www.imperialviolet.org/2011/03/18/revocation.html"> About how browsers warn about failed revocation checks with</a><br /><br />

      <div class="row" style="margin-top:5vw;border-top:1px solid #4f4f4f;">
        <div id="relatedArticles" class="col-md-6 col-sm-6 col-xs-6">
          <h3>Further Reading</h3>
          <p>
	           Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
	        </p>
        </div>

        <div id="relatedArticles" class="col-md-6 col-sm-6 col-xs-6">
          <h3>Related Articles</h3>
          <ul>
      	    <li><a href="http://ciscodemo.isi.jhu.edu/template3.html#">Properly Storing Passwords</a></li>
      	    <li><a href="http://ciscodemo.isi.jhu.edu/template3.html#">Hashes for File Verification</a></li>
      	    <li><a href="http://ciscodemo.isi.jhu.edu/template3.html#">Digital Signatures for File Verification</a></li>
      	  </ul>
        </div>
      </div>


      <div class="footerfix"></div>
      <footer class="footer">© 2017 Important legal stuff and/or links to usage restrictions etc.
      </footer>
    </div>

  </body>
</html>
