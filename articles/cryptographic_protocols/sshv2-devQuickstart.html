<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>SSHv2 Dev Quickstart</title>
    <meta name="robots" content="noindex, noarchive, nofollow">
    <link rel="stylesheet" href="http://www.cisco.com/etc/designs/cdc/clientlibs/responsive/css/cisco-sans.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="shortcut icon" href="lock-icon.ico">

    <!-- <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,300' rel='stylesheet' type='text/css'> -->

    <!-- Animate.css -->
    <link rel="stylesheet" href="../../css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="../../css/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="../../css/bootstrap.css">
    <!-- Superfish -->
    <link rel="stylesheet" href="../../css/superfish.css">

    <!--<link rel="stylesheet" href="../../css/style.css">-->


    <!-- Modernizr JS -->
    <script src="../../js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="js/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="../../css/style-mockup1.css" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  </head>

  <body background>
    <div id="header">
      <header id="fh5co-header-section">
        <div class="container">
          <div class="nav-header">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <h1 id="fh5co-logo"><a href="..\..\index.html"><strong><font color="white">Crypto Done Right!</font></strong></a></h1>
            <!-- START #fh5co-menu-wrap -->
            <nav id="fh5co-menu-wrap" role="navigation">
              <ul class="sf-menu" id="fh5co-primary-menu">
                <!--<li class="active">
                  <a href="index.html"><font color="black">Home</font></a>
                </li>-->
                <li>
                  <a href="..\..\articles\cryptographic_protocols\cryptographic-protocols.html" class="fh5co-sub-ddown"><font color="white">Cryptographic Protocols</font></a>
                  <ul class="fh5co-sub-menu">
                    <li><a href="..\..\articles\cryptographic_protocols\basics.html" ><font color="black">Basics</font></a></li>
                    <li><a href="#" class="fh5co-sub-ddown">SSL</a>
                        <ul class="fh5co-sub-menu">
                          <li><a href="..\..\articles\cryptographic_protocols\ssl-2.html">SSL 2.0</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\ssl-3.html">SSL 3.0</a></li>
                        </ul>
                    </li>
                    <li><a href="#" class="fh5co-sub-ddown">TLS</a>
                        <ul class="fh5co-sub-menu">
                          <li><a href="..\..\articles\cryptographic_protocols\tls-1.html">TLS 1.0</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\tls-1-1.html" >TLS 1.1</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\tls-1-2.html" >TLS 1.2</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\tls-1-3.html" >TLS 1.3</a></li>
                        </ul>
                    </li>
                    <li><a href="#" class="fh5co-sub-ddown">SSH</a>
                        <ul class="fh5co-sub-menu">
                          <li><a href="..\..\articles\cryptographic_protocols\sshv1.html" >SSH 1.0</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\sshv2.html" >SSH 2.0</a></li>
                        </ul>
                    </li>
                  </ul>
                </li>

                <li>
                  <a href="..\..\articles\cryptographic_protocols\encryption.html" class="fh5co-sub-ddown"><font color="white">Encryption</font></a>
                  <ul class="fh5co-sub-menu">
                    <li><a href="..\..\articles\cryptographic_protocols\encryption.html" ><font color="black">Introduction</font></a></li>
                      <li><a href="#" class="fh5co-sub-ddown">AES</a>
                        <ul class="fh5co-sub-menu">
                          <li><a href="..\..\articles\cryptographic_protocols\aes.html" >Introduction</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\aes-ctr.html" >AES CTR</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\aes-cbc.html" >AES CBC</a></li>
                          <li><a href="..\..\articles\cryptographic_protocols\aes-gcm.html">AES GCM</a></li>
                        </ul>
                      </li>
                    <li><a href="#" class="fh5co-sub-ddown">DES</a></li>
                    <li><a href="..\..\articles\cryptographic_protocols\3des.html" class="fh5co-sub-ddown">3DES</a></li>
                  </ul>
                </li>

                <li>
                  <a href="#" class="fh5co-sub-ddown"><font color="white">Hashing Algorithms</font></a>
                   <ul class="fh5co-sub-menu">
                    <li><a href="..\..\articles\hashing_algorithms\example_index.html">Introduction</a></li>
                    <li>
                      <a href="#" class="fh5co-sub-ddown">Hash Functions</a>
                      <ul class="fh5co-sub-menu">
                          <li><a href="#" class="fh5co-sub-ddown">Unkeyed</a>
                        <ul class="fh5co-sub-menu">
                          <li><a href="..\..\articles\hashing_algorithms\md5.html" >MD5</a></li>
                          <li><a href="..\..\articles\hashing_algorithms\sha1.html" >SHA-1</a></li>
                          <li><a href="..\..\articles\hashing_algorithms\sha2.html" >SHA-2</a></li>
                          <li><a href="..\..\articles\hashing_algorithms\sha3.html" >SHA-3</a></li>
                        </ul>
                        </li>
                          <li><a href="#" class="fh5co-sub-ddown">Keyed</a>
                        <ul class="fh5co-sub-menu">
                          <li><a href="http://freehtml5.co/preview/?item=build-free-html5-bootstrap-template" tar
                                 ="_blank">More to come..</a></li>
                            </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><a href="..\..\about.html"><font color="white">About</font></a></li>
                <li><a href="..\..\contact.html"><font color="white">Contact</font></a></li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
    </div>

    <div class="breadcrumbs">
      <ol class="breadcrumb">
         <li class="breadcrumb-item level"><a href="../../index.html">Home</a></li>
         <li class="breadcrumb-item level"><a href="../articles.html">Articles</a></li>
         <li class="breadcrumb-item level"><a href="cryptographic-protocols.html">Cryptographic Protocols</a></li>
         <li class="breadcrumb-item level0"><a href="sshv2.html">SSHv2</a></li>
         <li class="breadcrumb-item level1 active">SSHv2 Dev Quickstart</li>
       </ol>
    </div>

  <a href="flaw-categories.html"><div class="alert alert-warning">
      <strong>Background Reading: Understanding Different Types of Problems in Crypto.</strong>
    </div></a>

    <div class="container-fluid">
      <div class="row" style="padding: 2vw;">

<p id="nocryptoroll">
  <div class="col-md-12 col-sm-12 col-xs-12">

        <h2> <img src="../../images/implementation.png " style="width:100px;height:100px;" /> SSHv2 Implementation</h2>

        <font size="4"><strong>What to expect:</strong></font><br /> <br />
        SSHv2 is a client-server protocol that relies on the following concepts. When the requirement is to set up SSH for an application or system, here are the key terms that are to be expected: <br /> <br />

        Here are the basic steps involved in an SSH handshake:<sup>1</sup><br />
        <ul>
          <li>Negotiating the version of the protocol to use.</li>
          <li>Negotiating cryptographic algorithms and other options to use.</li>
          <li>Negotiating a one-time session key for encrypting the rest of the session.</li>
          <li>Authenticating the server host using its host key.</li>
          <li>Authenticating the user using a password, public key authentication, or other means.</li>
        </ul><br /><br />

        <b><u>Authentication Scheme:</u></b> SSHv2 provides a few options when it comes to authentication (client authenticating the server and itself). Different authentication schemes could be appropriate for different setups. But a general recommendation IS TO AVOID PASSWORD as SSH keys are long and complex, far more than any password could be and keys don't get transmitted to the remote system (except key forwarding, natch) which passwords need to be. <a href="https://www.ssh.com/ssh/key/">https://www.ssh.com/ssh/key/</a>. The details of this method depend on the public-key algorithm chosen. In essence, the client sends a message to the server that contains the client's public key, with the message signed by the client's private key. When the server receives this message, it checks to see whether the supplied key is acceptable for authentication and, if so, it checks to see whether the signature is correct. <br /> <br />

        <b><u>Setting up keys:</u></b> SSH protocol uses cryptographic keys in order to secure communication between the server and the client. These keys could be of type RSA, DSA or ECDSA for example. Note that OpenSSH, one of the most popular libraries used by vendors to implement SSH, has removed support for DSA keys because of security concerns.  <br /> <br />

        <b><u>CipherSuites and KeyExchange Algorithm:</u></b> These are the settings that determine which encryption algorithm and message integrity algorithm will be used for securing data. Also, the key-exchange protocol (DH or ECDH) will be negotiated between the client and the server. <br /> <br />

        <b><u>Setting up communication:</u></b> SSH by default listens on TCP port 22. This can, however, be changed with almost any vendor. <br /> <br />


<font size="4"><strong>Concept:</strong></font>  DO NOT roll your own Crypto! Use standard services and libraries. <br />

It is NOT advisable in any circumstances to develop any sort of cryptography on your own. Instead, there are a few options for standard libraries that can be used.
These libraries offer better stability as they are usually a product of several years of experience in implementing cryptography by an active development community who are
dedicated towards efforts in implementation. It is therefore considered to be reliable and robust. <br /> <br />


<font size="3"><strong>Examples:</strong></font>
OpenSSH is one such library which popular and therefore is used as an example of this concept. OpenSSH is not the only available crypto library but is widely used and is therefore recommended. <br />
For a quick overview of comparison between some of the other libraries available, visit here  <a href="https://en.wikipedia.org/wiki/Comparison_of_SSH_servers">https://en.wikipedia.org/wiki/Comparison_of_SSH_servers </a> <br /> <br />

Please note that OpenSSH has removed support for all older SSH protocols since version 7.6. All the release notes of their latest releases can be found here: https://www.openssh.com/. The older SSH 1 protocol comes in two major sub-variants: protocol 1.3 and protocol 1.5. Support for both has been removed from OpenSSH as of the 7.6 release.
<br /> <br />

How to check for the OpenSSH version: <br /> <br />
Not all vendors will let you find out about this information using commands. It is usually documented otherwise. But, for most Linux environments the command is: <br />
<pre>
  <code>
# ssh -v
  </code>
  </pre>

Here is an excellent resource to find details about how OpenSSH can be built and used: https://docstore.mik.ua/orelly/networking_2ndEd/ssh/ch04_03.htm
<br /> <br />
<strong><u>Implementing SSH in Python:</u></strong> <br />
Python has its own set of libraries which act as wrappers around either other libraries such as libSSH in C which in turn could be wrappers for OpenSSH, a popular example being ssh2-python. There are other libraries such as Paramiko. Both of these libraries do the same thing but there are claims about better performance with ssh2-python. For a detailed study of comparison, visit here: https://parallel-ssh.org/post/ssh2-python/ <br /> <br />

Here is documentation for implementing both the libraries: <br />
<a href="https://prezi.com/zjpqutpygshm/paramiko-in-5-minutes-sshv2-in-python/">SSHv2 using Paramiko</a> <br />
<a href="https://github.com/ParallelSSH/ssh2-python">SSHv2 using ParallelSSH</a> <br />
<a href="https://parallel-ssh.org/">Documentation on Parallel SSH</a> <br /> <br /><br />

Some of the less common libraries are:<br />
<a href="https://twistedmatrix.com/trac/wiki/TwistedConch">TwistedConch</a><br />
<a href="http://docs.fabfile.org/">Fabric</a><br /><br />

<strong><u>Implementing SSH in C/C++: </u></strong><br />
LibSSH is a popular choice for setting up SSHv2 server or client in C/C++. For more information, visit their official page: <a href="https://www.libssh.org">https://www.libssh.org</a>. For a set of working examples, refer to their <a href="http://api.libssh.org/stable/libssh_tutorial.html"> Tutorial Page. </a><br /><br />

<strong><u>Implementing SSH in Java: </u></strong><br />
<a href="http://www.jcraft.com/jsch/">The Java Secure Channel (JSCH)</a> is a very popular library to implement an SSH client, open source and has a BSD style license. Here is a good set of examples to get you started with integrating an SSH client in your Java application.
<a href="http://mina.apache.org/sshd-project/index.html">The Apache Mina project</a> can be used to create SSH servers (as well as clients) in your JAVA application. A simple lookup of "Apache Mina examples" will give you a bunch of examples.<br /><br />

<strong><u>Implementing SSH in Perl</u></strong><br />
<ul>
<li>Net::SSH2: a wrapper module for libssh2.</li>
<li>Net::SSH::Perl: a full SSH/SFTP implementation in pure Perl. Unfortunately, this module is not being maintained anymore and has several open bugs. Also, installing it can be a daunting task due to some of its dependencies.</li>
<li>Net::OpenSSH: a wrapper for OpenSSH binaries and other handy programs (scp, rsync, sshfs). It uses OpenSSH multiplexing feature in order to reuse connections.</li>
<li>Net::OpenSSH::Parallel a module build on top of Net::OpenSSH that allows to transfer files and run programs on several machines in parallel efficiently.</li>
<li>SSH::Batch another module build on top of Net::OpenSSH that allows to run programs on several hosts in parallel.</li>
<li>Net::SSH::Expect: this module uses Expect to drive interactive shell sessions run on top of SSH.</li>
<li>Net::SSH: a simple wrapper around any SSH client. It does not support password authentication and is very slow as it establishes a new SSH connection for every remote program invoked.</li>
<li>Net::SCP and Net::SCP::Expect: modules wrapping the scp program. Note that Net::SSH2, Net::SSH::Perl and Net::OpenSSH already support file transfers via scp natively.</li>
<li>Net::SFTP::Foreign: a full SFTP client written in Perl with lots of bells and whistles. By default is uses ssh to connect to the remote machines but it can also run on top of Net::SSH2 and Net::OpenSSH.</li>
<li>GRID::Machine, IPC::PerlSSH and SSH::RPC: these modules allow to distribute and run Perl code on remote machines through SSH.</li>
</ul><br />

<strong><u>Implementing SSH in Ruby</u></strong><br />
<ul>
  <li><a href="https://github.com/net-ssh">Net::SSH</a></li>
  <li><a href="https://github.com/capistrano/capistrano">Capistrano</a></li>
</ul><br /><br />

<h2>Top Things to remember while implementing SSH in your code</h2><br />
<ul>
  <li>Use SSH public key based login</li>
  <li>Ensuring proper privilege management</li>
  <li>Disable password based login</li>
  <li>Disable Empty Passwords</li>
  <li>Use strong passwords and passphrase for ssh users/keys</li>
  <li>Firewall SSH TCP port #22 needs to be open on your host running the application</li>
  <li>Secure Key Excgahange Algorithms (Examples are curve25519-sha256: ECDH over Curve25519 with SHA2 and diffie-hellman-group-exchange-sha256: Custom DH with SHA2)</li>
  <li>Ensure only strong cipher suites are allowed (Recommendations as of Oct,2018: Encryption: aes256-gcm, aes128-gcm, aes256-ctr, aes192-ctr, aes128-ctr MAC: hmac-sha2-512-etm, hmac-sha2-256-etm, hmac-sha2-512, hmac-sha2-256)</li>
  <li>Checking for open vulnerabilties in your libraries </li>
  <li>Ensure good length of keys (DSA and RSA 1024 bit or lower ssh keys are considered weak. Avoid them. RSA keys are chosen over ECDSA keys when backward compatibility is a concern with ssh clients. All ssh keys are either ED25519 or RSA. Do not use any other type).</li>
</ul><br />
While following and implementing the above recommendations is language and platform specific, here is a document <a href="https://www.cyberciti.biz/tips/linux-unix-bsd-openssh-server-best-practices.html"> to help you with understanding more about the recommendations. </a>
<br />

</p>

<p id="tls12patch">
<h2> <img src="../../images/patch.png " style="width:100px;height:100px;" /> Upgrade/Patch Management </h2>

<font size="4"><strong>Concept:</strong></font> OpenSSH, one of the most popular library used to implement SSH has had a few flaws exploited. Software developers should always keep a close watch on any patches or upgrade notifications from product vendors/libraries (please note that some libraries simply act as wrappers around OpenSSH). The expectation is that these patches will not particularly target protocol vulnerabilities but rather implementation ones. For example, a software bug in Cisco product allows compromise of SSHv2's security. Understanding a newly released patch or upgrade should be possible by reading its respective documentation and queries of any sort should be clarified with the product manufacturers to ensure a smooth process with no adverse impacts. One of the recent bugs found is <a href="https://www.zdnet.com/article/security-flaw-in-libssh-leaves-thousands-of-servers-at-risk-of-hijacking/">CVE-2018-10933</a>.  <br />
<br />
Note: Keep an eye out for this section as it will be kept up-to-date with any major patches that are released. As always, keep an eye out on CVE Details: <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-120/SSH.html">CVE Details: SSH vulnerabilities</a>.
</p>

 </div>
      </div>


       <div class="row" style="margin-top:5vw;border-top:1px solid #4f4f4f;">
        <div id="relatedArticles" class="col-md-6 col-sm-6 col-xs-6">
          <h3>References</h3>
	          <ul>
			  <li><a href="https://www.ssh.com/ssh/key/">[1] SSH.com: SSH KEY</a></li>
			  </ul>
        </div>

        <div id="relatedArticles" class="col-md-6 col-sm-6 col-xs-6">
          <h3>Related Articles</h3>
	          <ul>
        <li><a href="https://www.digitalocean.com/community/tutorials/how-to-configure-ssh-key-based-authentication-on-a-linux-server">Digital Ocean: How to Configure SSH Key-Based Authentication on a Linux Server</a></li>

      </ul>
        </div>
      </div>


      <div class="footerfix"></div>
      <footer class="footer">Copyright © 2019 Crypto Done Right All rights reserved.
      </footer>
    </div>

  </body>
</html>
